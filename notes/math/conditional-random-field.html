<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>条件随机场（Conditional Random Field）</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="/static/custom.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">条件随机场（Conditional Random Field）</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#随机场"><span class="toc-section-number">1</span> 随机场</a></li>
<li><a href="#线性链条件随机场的参数化形式"><span class="toc-section-number">2</span> 线性链条件随机场的参数化形式</a></li>
<li><a href="#三个基本问题"><span class="toc-section-number">3</span> 三个基本问题</a></li>
<li><a href="#参考"><span class="toc-section-number">4</span> 参考</a></li>
</ul>
</nav>
<h1 id="随机场"><span class="header-section-number">1</span> 随机场</h1>
<p>随机场是由若干个位置组成的整体，当给每一个位置中按照某种分布随机赋予一个值后，其全体就叫做随机场。而马尔可夫随机场是随机场的一个特例，它假设随机场中某一个位置的赋值仅仅与它相邻的位置的赋值有关。条件随机场则是马尔可夫随机场的特例，它假设马尔可夫随机场中只有<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>两种变量，<span class="math inline">\(X\)</span>一般是给定的，而<span class="math inline">\(Y\)</span>一般是在给定<span class="math inline">\(X\)</span>的条件下我们的输出，数学语言描述为：</p>
<p>设<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>是随机变量，<span class="math inline">\(P(Y|X)\)</span>是给定<span class="math inline">\(X\)</span>时<span class="math inline">\(Y\)</span>的条件概率分布，若随机变量<span class="math inline">\(Y\)</span>构成的是一个马尔可夫随机场，则称条件概率分布<span class="math inline">\(P(Y|X)\)</span>是条件随机场。</p>
<pre><code>比如，在词性标注的场景中，词本身的集合就是$X$，而所有词对应的词性就是$Y$</code></pre>
<p>如果<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>有相同的结构，则称条件随机场为线性链随机场。其数学定义为：</p>
<p>假设<span class="math inline">\(X=(X_1,X_2,\cdots,X_n)\)</span>，<span class="math inline">\(Y=(Y_1,Y_2,\cdots,Y_N)\)</span>均为线性链表示的随机变量序列，在给定随机变量序列<span class="math inline">\(X\)</span>的情况下，随机变量<span class="math inline">\(Y\)</span>的条件概率分布<span class="math inline">\(P(Y|X)\)</span>构成条件随机场，即满足马尔可夫性<span class="math inline">\(P(Y_i|X,Y_1,Y_2,\cdots,Y_N)=P(Y_i|X,Y_{i-1},Y_{i+1})\)</span>，则称<span class="math inline">\(P(Y|X)\)</span>为线性链条件随机场。</p>
<h1 id="线性链条件随机场的参数化形式"><span class="header-section-number">2</span> 线性链条件随机场的参数化形式</h1>
<p>通过特征函数及其权重系数，可以将线性链条件随机场问题转化为机器学习模型。特征函数分为两类：</p>
<ul>
<li>第一类是定义在<span class="math inline">\(Y\)</span>节点上的节点特征函数，这类特征函数只和当前节点有关，记为：<span class="math inline">\(s_l(y_i,x,i),l=1,2,...L\)</span>其中<span class="math inline">\(L\)</span>是定义在该节点特征函数的总个数，<span class="math inline">\(i\)</span>是当前节点在序列中的位置；</li>
<li>第二类是定义在<span class="math inline">\(Y\)</span>上下文的局部特征函数，这类特征函数只和当前节点和上一个节点有关，记为：<span class="math inline">\(t_k(y_{i-1},y_i,x,i),k=1,2,...K\)</span>其中<span class="math inline">\(K\)</span>是定义在该节点的局部特征函数的总个数，<span class="math inline">\(i\)</span>是当前节点在序列的位置。</li>
</ul>
<p>两种特征函数的取值只能是0或者1，即满足特征条件或者不满足特征条件，整体上，线性链条件随机场的参数化形式为：</p>
<p><span class="math display">\[P(y|x)=\frac{1}{Z(x)}\text{exp}(\sum_{i,k}\lambda_kt_k(y_{i-1},y_i,x,i)+\sum_{i,l}\mu_ls_l(y_i,x,i))\]</span></p>
<p>其中<span class="math inline">\(Z(x)\)</span>为规范化因子：</p>
<p><span class="math display">\[Z(x)=\sum_y\text{exp}(\sum_{i,k}\lambda_kt_k(y_{i-1},y_i,x,i)+\sum_{i,l}\mu_ls_l(y_i,x,i))\]</span></p>
<p>整个参数化形式也可以简化为：假设某一个节点有<span class="math inline">\(K_1\)</span>个局部特征函数和<span class="math inline">\(K_2\)</span>个节点特征函数，总共有<span class="math inline">\(K=K_1+K_2\)</span>个特征函数，用一个特征函数<span class="math inline">\(f_k(y_{i-1},y_i,x,i)\)</span>来统一表示：</p>
<p><span class="math display">\[
f_k(y_{i-1},y_i,x,i)=\begin{cases}
t_k(y_{i-1},y_i,x,i),&amp; k=1,2,...K_1\\
s_l(y_i,x,i),&amp; k=K_1+l,l=1,2,...K_2
\end{cases}
\]</span></p>
<p>对<span class="math inline">\(f_k(y{i-1},y_i,x,i)\)</span>在各个序列位置求和得到：</p>
<p><span class="math display">\[f_k(y,x)\sum_{i=1}^nf_k(y_{i-1},y_i,x,i)\]</span></p>
<p>统一<span class="math inline">\(f_k(y{i-1},y_i,x,i)\)</span>对应的权重系数<span class="math inline">\(w_k\)</span>：</p>
<p><span class="math display">\[
w_k=\begin{cases}
\lambda_k&amp; k=1,2,...K_1\\
\mu_l&amp; k=K_1+l,l=1,2,...K_2
\end{cases}
\]</span></p>
<p>因此整个线性链条件随机场的参数化形式简化为：</p>
<p><span class="math display">\[P(y|x)=\frac{1}{Z(x)}\text{exp}\sum_{k=1}^Kw_kf_k(y,x)\]</span></p>
<p>其中<span class="math inline">\(Z(x)\)</span>为规范化因子：</p>
<p><span class="math display">\[Z(x)=\sum_y\text{exp}\sum_{k=1}^Kw_kf_k(y,x)\]</span></p>
<p>用向量化表示<span class="math inline">\(w_k\)</span>和<span class="math inline">\(f_k\)</span>则有：</p>
<p><span class="math display">\[w=(w_1,w_2,...,w_K)^T\]</span> <span class="math display">\[F(y,x)=(f_1(y,x),f_2(y,x),...,f_K(y,x))^T\]</span></p>
<p>线性链条件随机场进一步简化为内积形式：</p>
<p><span class="math display">\[P_w(y|x)=\frac{\text{exp}(w{\cdot}F(y,x))}{Z_w(x)}=\frac{\text{exp}(w{\cdot}F(y,x))}{\sum_y\text{exp}(w{\cdot}F(y,x))}\]</span></p>
<h1 id="三个基本问题"><span class="header-section-number">3</span> 三个基本问题</h1>
<ol type="1">
<li>评估。即给定 linear-CRF 的条件概率分布<span class="math inline">\(P(y|x)\)</span>，在给定输入序列<span class="math inline">\(x\)</span>和输出序列<span class="math inline">\(y\)</span>时，计算条件概率<span class="math inline">\(P(y_i|x)\)</span>和<span class="math inline">\(P(y_{i-1},y_i|x)\)</span>以及对应的期望；</li>
<li>学习。给地给你训练数据集<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>，学习模型参数<span class="math inline">\(w_k\)</span>和条件概率<span class="math inline">\(P_w(y|x)\)</span>；</li>
<li>解码。给定条件概率分布<span class="math inline">\(P(y|x)\)</span>和输入序列<span class="math inline">\(x\)</span>，计算使条件概率最大的输出序列<span class="math inline">\(y\)</span>。</li>
</ol>
<h1 id="参考"><span class="header-section-number">4</span> 参考</h1>
<ul>
<li><a href="https://www.cnblogs.com/pinard/p/7048333.html">条件随机场CRF(一)从随机场到线性链条件随机场</a></li>
<li>《统计学习方法》</li>
</ul>
</body>
</html>
